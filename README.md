## èƒŒæ™¯

åœ¨é¡¹ç›®ä¸­ï¼Œæœ‰åœ¨Appå†…æ‰“å¼€ä¸‰æ–¹ç½‘ç«™çš„éœ€æ±‚ï¼Œæ‰¾äº†å‡ ä¸ª`Flutter`çš„æ’ä»¶ï¼Œå’Œéœ€æ±‚æœ€åŒ¹é…çš„æ˜¯`flutter_webview_plugin`ï¼Œå¯é›†æˆåˆ°é¡¹ç›®ä¸­ä»¥åï¼Œå‡ºç°æ˜æ˜¾çš„å¡é¡¿ç°è±¡ï¼Œå› æ­¤æ— æ³•è¾ƒå¥½çš„æ»¡è¶³éœ€æ±‚ã€‚
å›æƒ³`Flutter`å®˜æ–¹ç»™å‡ºçš„ä¾‹å­ï¼Œå…¶ä¸­æœ‰ä¸€ä¸ªå°±æ˜¯åˆ‡æ¢åŸç”Ÿç•Œé¢å’Œ`Flutter`ç•Œé¢çš„ï¼Œäºæ˜¯å°è¯•å®ç°æ•ˆæœã€‚
PSï¼šåœ¨å®ç°ä¹‹å‰ï¼Œæœ¬æƒ³å°è£…æˆæ’ä»¶ï¼Œç»“æœå†™å®Œæ’ä»¶çš„è”é€šæ–¹æ³•åï¼Œå‘ç°æ— æ³•æ“ä½œç•Œé¢ï¼Œäºæ˜¯é‡æ–°å›åˆ°ä¸Šé¢çš„æ€è·¯ï¼Œåªèƒ½å†™æ­»åˆ°é¡¹ç›®ä¸­ã€‚é¦–å…ˆä»‹ç»ä¸‹å¦‚ä½•ä½¿ç”¨æ’ä»¶æ¥æ‰“é€šåŸç”Ÿå’Œ`Flutter`ï¼Œä½¿ç”¨ `iOS` ä»£ç æ¼”ç¤ºã€‚

## æ’ä»¶å®ç°

å¤§è‡´æ€è·¯æ˜¯ï¼Œ`Flutter` å’Œ `iOS` ä¹‹é—´å®šä¹‰å¥½ Channel åï¼Œå¯ä»¥ç†è§£ä¸ºä¸€ä¸ªé€šä¿¡é¢‘é“ï¼Œå»ºç«‹åï¼Œå¯ä»¥ç›¸äº’å‘é€æ¶ˆæ¯ï¼Œæ¥æ”¶åˆ°æ¶ˆæ¯åï¼Œæ‰§è¡Œå„è‡ªçš„æ“ä½œï¼Œç”±æ­¤å¯ä»¥çœ‹å‡ºå‡ ç‚¹æ³¨æ„äº‹é¡¹

1. æ‰“å¼€ä¸€ä¸ªç›¸åŒçš„ Channel é¢‘é“ï¼Œå¦‚æœæ²¡æ³•é€šä¿¡ï¼Œè¯·ä»”ç»†æ£€æŸ¥åç§°æ˜¯å¦æ­£ç¡®ã€‚
2. å‘é€å’Œæ¥æ”¶è¦å¯¹åº”ï¼Œä» `Flutter` å‘é€ä¸€æ¡æ¶ˆæ¯ç»™åŸç”Ÿï¼ŒåŸç”Ÿå¯¹åº”æœ‰ä¸ªæ–¹æ³•æ¥å¤„ç†æ”¹æ¶ˆæ¯ã€‚å½“ç„¶ï¼Œä¸å¤„ç†ä¸ä¼šæœ‰é—®é¢˜ï¼Œå…»æˆä¹ æƒ¯ï¼Œå…ˆæ£€æµ‹é€šä¿¡æ˜¯å¦æ­£å¸¸ï¼Œå†åšå…¶ä»–é€»è¾‘æ“ä½œã€‚
æ¥ä¸‹æ¥å°±æ˜¯è¯¦ç»†çš„æ­¥éª¤

### åˆ›å»ºé¡¹ç›®

é€šè¿‡ Android Studio åˆ›å»º Flutter é¡¹ç›®ï¼Œé€‰æ‹© Plugin ç±»å‹ï¼Œå¦‚å›¾  
![å±å¹•å¿«ç…§ 2019-02-26 ä¸‹åˆ4.42.45.png](https://groups.google.com/group/baizi-blog/attach/6be997a0cfab2/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202019-02-26%20%E4%B8%8B%E5%8D%884.42.45.png?part=0.5&view=1&authuser=1)

### è¿è¡Œé¡¹ç›®

åˆ›å»ºå¥½åï¼Œç›´æ¥è¿è¡Œé¡¹ç›®ï¼Œå¯åŠ¨å`Flutter`é»˜è®¤ä¼šé€šè¿‡`Channel`è·å–ç³»ç»Ÿç‰ˆæœ¬ï¼Œç»“æœå¦‚ä¸‹

![å±å¹•å¿«ç…§ 2019-02-26 ä¸‹åˆ4.45.24.png](https://groups.google.com/group/baizi-blog/attach/6be997a0cfab2/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202019-02-26%20%E4%B8%8B%E5%8D%884.45.24.png?part=0.6&view=1&authuser=1)

### åœ¨`Flutter`ç«¯ç¼–å†™è°ƒç”¨æ–¹æ³•æµ‹è¯•ä»£ç 

æ‰“å¼€ lib ä¸‹çš„æ–‡ä»¶ï¼ˆè¯¥æ–‡ä»¶å’Œæ’ä»¶åä¸€è‡´ï¼Œæˆ‘çš„å«flutter_open_native_pageï¼‰ï¼Œæ–°å¢åä¸º`ping`çš„æ–¹æ³•

```dart
static Future<String> ping() async {
  final String result = await _channel.invokeMethod("ping");
  return result;
}
```

### åœ¨ `iOS` ç«¯ç¼–å†™å“åº”æ–¹æ³•å®ç°ä»£ç 
æ‰“å¼€ iOS/Classes/ ä¸‹çš„æ–‡ä»¶çš„ .m æ–‡ä»¶ï¼Œå’Œä¸Šé¢ä¸€æ ·ï¼Œå’Œæ’ä»¶åå¯¹åº”çš„ï¼Œæˆ‘çš„ä¸º FlutterOpenNativePlugin.mï¼Œåœ¨ `- handleMethodCall:result:` æ–¹æ³•ä¸­æ–°å¢æ¥æ”¶åˆ°`ping`æ¶ˆæ¯çš„å®ç°æ–¹æ³•

```objectivec
- (void)handleMethodCall:(FlutterMethodCall*)call result:(FlutterResult)result {
  if ([@"getPlatformVersion" isEqualToString:call.method]) {
    result([@"iOS " stringByAppendingString:[[UIDevice currentDevice] systemVersion]]);
  } else if([@"ping" isEqualToString:call.method]){
    result(@"ä»iOSè¿”å›: pong");
  } else {
    result(FlutterMethodNotImplemented);
  }
}
```

### æµ‹è¯•æ’ä»¶

æ‰“å¼€ example/lib/main.dart æ–‡ä»¶ï¼Œåœ¨ `initState` æ–¹æ³•ä¸­æ–°å¢`testPing`æ–¹æ³•ï¼Œ

```dart
void testPing() async {  
  String result;  
  
  try {  
  result = await FlutterOpenNative.ping();  
 } on PlatformException {  
  result = "é€šä¿¡æ•…éšœï¼Œæ£€æŸ¥channelåæ˜¯å¦åŒ¹é…";  
 }  
  print("ç»“æœï¼š$result");  
}
```

æ›´å¤šçš„ç”¨æ³•è¯·å‚è€ƒå®˜ç½‘ã€‚ä¸‹é¢è¿›å…¥ä¸»é¢˜ï¼Œå®ç°`Flutter`æ‰“å¼€åŸç”Ÿç•Œé¢çš„ä»£ç ã€‚

  
## `Flutter` æ‰“å¼€åŸç”Ÿç•Œé¢

é€šè¿‡ä¸Šæ–‡çš„ä»‹ç»ï¼Œå¤§è‡´äº†è§£äº†å¦‚ä½•å®ç°ç›¸äº’è°ƒç”¨ã€‚ä¹Ÿå¯ä»¥çœ‹åˆ°ï¼Œæ’ä»¶ä»£ç å¹¶æœªæ¶‰åŠåˆ°ç•Œé¢ç›¸å…³çš„ä»£ç ï¼Œæ²¡æœ‰åˆé€‚çš„å…¥å£å°±æ— æ³•æ‰“å¼€æ–°çš„ç•Œé¢ã€‚é€šè¿‡æŸ¥çœ‹`Flutter`å®˜æ–¹ [Demo PlatformView](https://github.com/flutter/flutter/tree/master/examples/platform_view) å‘ç°äº†åˆé€‚çš„å…¥å£ï¼Œå³`AppDelegate`ã€‚å…ˆä¿®æ”¹ `AppDelegate` ä¸­çš„å¤„ç†ä»£ç ï¼Œç„¶åå†å®ç°`Flutter`çš„è°ƒç”¨ã€‚

### AppDelegate ä¸­çš„å¤„ç†ä»£ç 

ä¸‹é¢æ˜¯ `PlatformView` çš„ä»£ç 

```objectivec
- (BOOL)application:(UIApplication *)application
didFinishLaunchingWithOptions:(NSDictionary *)launchOptions {
  [GeneratedPluginRegistrant registerWithRegistry:self];
  FlutterViewController* controller =
  (FlutterViewController*)self.window.rootViewController;
  FlutterMethodChannel* channel =
  [FlutterMethodChannel methodChannelWithName:@"samples.flutter.io/platform_view"
                              binaryMessenger:controller];
  [channel setMethodCallHandler:^(FlutterMethodCall* call, FlutterResult result) {
    if ([@"switchView" isEqualToString:call.method]) {
      _flutterResult = result;
      PlatformViewController* platformViewController =
      [controller.storyboard instantiateViewControllerWithIdentifier:@"PlatformView"];
      platformViewController.counter = ((NSNumber*)call.arguments).intValue;
      platformViewController.delegate = self;
      UINavigationController* navigationController =
      [[UINavigationController alloc] initWithRootViewController:platformViewController];
      navigationController.navigationBar.topItem.title = @"Platform View";
      [controller presentViewController:navigationController animated:NO completion:nil];
    } else {
      result(FlutterMethodNotImplemented);
    }
  }];
  return [super application:application didFinishLaunchingWithOptions:launchOptions];
}
```

æˆ‘ä»¬åšé€‚å½“ä¿®æ”¹ï¼Œå¦‚ä¸‹

```objectivec

- (BOOL)application:(UIApplication *)application
didFinishLaunchingWithOptions:(NSDictionary *)launchOptions {
  [GeneratedPluginRegistrant registerWithRegistry:self];
  FlutterViewController* controller =
  (FlutterViewController*)self.window.rootViewController;
  FlutterMethodChannel* channel =
  [FlutterMethodChannel methodChannelWithName:@"io.baizi.flutter_open_native"
                              binaryMessenger:controller];
  [channel setMethodCallHandler:^(FlutterMethodCall* call, FlutterResult result) {
    if ([@"open_webview" isEqualToString:call.method]) { // ä¿®æ”¹äº†æ–¹æ³•å
      UIViewController *vc = [[UIViewController alloc] init]; // ä½¿ç”¨æœ€ç®€å•çš„viewcontroller
      vc.view.backgroundColor = [UIColor whiteColor]; // ä¸è®¾ç½®èƒŒæ™¯é¢œè‰²ï¼Œä¼šå‡ºç°ç©ºç™½ï¼Œå¹¶ä¸”æ‰å¸§æƒ…
      UINavigationController* navigationController =
      [[UINavigationController alloc] initWithRootViewController:vc];
      navigationController.navigationBar.topItem.title = @"æµè§ˆå™¨";
      [controller presentViewController:navigationController animated:YES completion:nil];// å¢åŠ åŠ¨ç”»ï¼Œå¦åˆ™ä¸å®¹æ˜“çœ‹å‡ºæ¥å˜åŒ–
    } else {
      result(FlutterMethodNotImplemented);
    }
  }];
  return [super application:application didFinishLaunchingWithOptions:launchOptions];
}
```


### Flutter ç«¯è°ƒç”¨ä»£ç å®ç°

åœ¨ example/lib/main.dart ä¸­ï¼Œå¢åŠ ä¸€ä¸ª `FloatingActionButton` ï¼Œç‚¹å‡»åé€šè¿‡ `MethodChannel` å‘åŸç”Ÿå‘é€æ¶ˆæ¯ï¼Œæ‰“å¼€æ–°çš„VCã€‚

```dart
@override
  Widget build(BuildContext context) {
    return MaterialApp(
      home: Scaffold(
        appBar: AppBar(
          title: const Text('Plugin example app'),
        ),
        body: Center(
          child: Text('Running on: $_platformVersion\n'),
        ),
        floatingActionButton: FloatingActionButton(onPressed: () {
          _methodChannel
              .invokeMethod("open_webview");
        }),
      ),
    );
  }
```

åˆ«å¿˜äº†å®šä¹‰ `_methodChannel` ï¼Œåœ¨`_MyAppState` ç±»ä¸­å®šä¹‰

```dart

static const MethodChannel _methodChannel =

MethodChannel('baizi.io.flutter_open_native');

```

è¿è¡Œä»£ç æµ‹è¯•æ˜¯å¦æ‰“å¼€äº†æ–°ç•Œé¢ã€‚

### åç»­

åªè¦èƒ½æ‰“å¼€åŸç”Ÿç•Œé¢ï¼Œåé¢çš„æµç¨‹å°±ä¸`Flutter`æ— å…³äº†ï¼Œå¯ä»¥èµ·é£ï½ï½ã€‚å®Œç»“ä¹‹å‰ï¼Œè¿˜æœ‰ä¸ªå°çŸ¥è¯†ï¼Œå°±æ˜¯`Flutter`è°ƒç”¨æ–¹æ³•æ—¶ï¼Œä¼ é€’å‚æ•°ï¼Œæ–¹æ³•å¦‚ä¸‹

```dart
static const MethodChannel _methodChannel =
MethodChannel('baizi.io.flutter_open_native', {url: "https://www.baidu.com"});
```

æ¥æ”¶å‚æ•°ä»£ç 

```objc
NSString *url = call.arguments[@"url"];  
```

å®Œç»“ğŸ‰